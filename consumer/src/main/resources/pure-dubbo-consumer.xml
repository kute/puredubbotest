<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:dubbo="http://code.alibabatech.com/schema/dubbo"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://code.alibabatech.com/schema/dubbo
                           http://code.alibabatech.com/schema/dubbo/dubbo.xsd">

    <dubbo:application name="pure-service-consumer" />

    <dubbo:annotation package="com.kute.service.impl" />

    <!--
    集群容错模式：http://dubbo.apache.org/books/dubbo-user-book/demos/fault-tolerent-strategy.html
    负载均衡：http://dubbo.apache.org/books/dubbo-user-book/demos/loadbalance.html
    -->
    <dubbo:consumer cluster="failover" loadbalance="consistenthash" />

    <!-- check=true 注册中心启动时检查(注册订阅失败时报错) -->
    <dubbo:registry protocol="${dubbo.registry.protocol}" address="${dubbo.registry.address}" check="true" />

    <!--
    引用暴露的服务
    1. check=true: 表示在启动时检查依赖的服务是否可用，不可用会不可用时会抛出异常，阻止 Spring 初始化完成，默认true
    若 Spring 容器是懒加载的，则check设置为false
    2. retries=2 : 失败时重试
     -->
    <dubbo:reference interface="com.kute.service.IUserService" id="userService" check="true" retries="2" cache="lru">
        <dubbo:method name="getUser" timeout="${dubbo.method.timeout}" retries="1" />
    </dubbo:reference>

</beans>